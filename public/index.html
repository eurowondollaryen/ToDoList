<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
	    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>To-Do-List</title>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>

        <style type="text/css">
            body {
                font-family: arial,sans-serif;
            }
            .nav-link {
                cursor: pointer;
            }
            .list {
                transition: .2s;
            }
            .list:hover {
                background-color: rgb(253, 226, 230);
                transition: .2s;
            }
            .lists {
                margin-top: 1rem;
                margin-bottom: 1rem;
                border-top: 2px solid lightgray;
                border-bottom: 2px solid lightgray;         
            }
            .stroked{
                text-decoration: line-through;
            }
            .pink-back {
                transition: .5s;
                background-color: pink;
            }
            .dark-back {
                transition: .5s;
                background-color: gray;
                color: white;
            }
            .midcheck {
                width: 1rem;
                height: 1rem;
                position: relative;
                top: 1rem;
            }
            .bigcheck {
                width: 1.5rem;
                height: 1.5rem;
                position: relative;
                top: 0.5rem;
            }
            .modbtn {
                width: 50%;
            }
            .changer {
                display: inline-block;
                width: 50%;
            }
            .row {
                height: 3rem;
                line-height: 3rem;
            }
            .title {
                padding-top: 1rem;
            }
            .form-input {
				box-sizing: border-box;
				-webkit-box-sizing: border-box;
				-moz-box-sizing: border-box;
				outline: none;
				display: inline-block;
				padding: 5px;
    			border: none;
    			border-bottom: 1px solid #ddd;
				background: transparent;
				margin-bottom: 10px;
				height: 45px;
			}
			.form-input:focus {
				border-bottom: 2px solid #007bff;
				transition: 0.2s;
			}
            .panel {
                width: 50%;
                text-align: center;
                border-left: 1px solid lightgray;
                float: left;
            }
        </style>
    </head>
    <body>
        <nav class="navbar navbar-expand-lg navbar-light bg-light">
            <a class="navbar-brand" href="#">To-Do-List</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNavDropdown">
                <ul class="navbar-nav">
                    <li class="nav-item active">
                        <a class="nav-link" data-toggle="modal" data-target="#howToUseModal">How To Use</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-toggle="modal" data-target="#addModal">Add Task</a>
                    </li>
                </ul>
            </div>
        </nav>
        
        <div class="container panel" id="left">
            <h4 class="title">해야할 일(no duedate)</h4>
            <div class="lists" id="undued">
            </div>
        </div>
        <div class="container panel" id="right">
            <h4 class="title">해야할 일(duedate)</h4>
            <div class="lists" id="dued">
            </div>
        </div>

        <!-- The How To Use Modal -->
        <div class="modal fade" id="howToUseModal">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
            
            <!-- Modal Header -->
            <div class="modal-header">
                <h4 class="modal-title">사용 방법</h4>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            
            <!-- Modal body -->
            <div class="modal-body">
                <p>1. 좌측 상단의 "Add Task" 를 눌러서 일정을 추가하세요.</p>
                <p>2. <input type="checkbox"> 를 이용해, 마감 기한을 넣으셔도 되고, 안 넣으셔도 돼요.</p>
                <p>3. 완료 처리를 하시려면, 목록 좌측의 체크박스를 누르세요.</p>
                <p>4. 일정을 수정하시려면, "수정" 버튼을 누르시고 수정하세요.</p>
                <P>5. 일정을 삭제하시려면, "삭제" 버튼을 누르세요.</P>
            </div>
            </div>
        </div>
        </div>
        <!-- The Add Modal -->
        <div class="modal fade" id="addModal">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
            
            <!-- Modal Header -->
            <div class="modal-header">
                <h4 class="modal-title">일정 추가</h4>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            
            <!-- Modal body -->
            <div class="modal-body">
                <div class="container" id="main">
                    <div class="container">
                        <label for='title'>제목 : </label>
                        <input type="text" class="form-input" id="title">
                    </div>
                    <div class="container">
                        <label for='content'>내용 : </label>
                        <input type="text" class="form-input" id="content">
                    </div>
                    <div class="container">
                        <label for='duedate'>기한 : </label>
                        <input type="date" class="form-input" id="duedate">
                        <label for="dueOrNot"><input type="checkbox" class="form-input midcheck" id="dueOrNot">기한 없음</label>
                    </div>
                    <div class="container">
                        <label for='priority'>우선 순위(낮을수록 중요) : </label>
                        <input type="number" class="form-input" id="priority" min="0" max="999">
                    </div>
                </div>
            </div>
            
            <!-- Modal footer -->
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal" id="addButton">추가하기</button>
            </div>
            
            </div>
        </div>
        </div>
        
        <script type="text/javascript">
            var schedule_nodue = [];//기한이 없는 일정 배열
            var schedule = [];//기한이 있는 일정 배열
            var schedule_nodue_index = [];
            var schedule_index = [];
            function is_late(date) {
                var currentTime = new Date();
                var arr = date.split("-");
                var year = currentTime.getFullYear();
                var month = 11;
                var day = currentTime.getDate();
                console.log(parseInt(arr[0]));
                console.log(parseInt(arr[1]));
                console.log(parseInt(arr[2]));
                console.log(year);
                console.log(11);
                console.log(day);
                if(parseInt(arr[0]) < year) return true;
                else if(parseInt(arr[0]) > year) return false;
                else {
                    if(parseInt(arr[1]) < month) return true;
                    else if(parseInt(arr[1]) > month) return false;
                    else {
                        if(parseInt(arr[2]) < day) {
                            return true;
                        }
                        else if(parseInt(arr[2]) > day) {
                            return false;
                        }
                        else {
                            return false;
                        }
                    }
                }
            }
            setInterval(function() {
                for(var i = 0; i < schedule_index.length; ++i) {
                    if(is_late(schedule[schedule_index[i]].due) && schedule[schedule_index[i]].finished == false) {
                        alert(schedule[schedule_index[i]].title + " 일정이 완료되지 않았어요!");
                    }
                }
            }, 3000);
            function done(number, is_undued) {
                if(is_undued == true) {
                    var check_undued = $("#check_undued" + number);
                    $("#title_undued" + number).toggleClass('stroked');
                    $("#content_undued" + number).toggleClass('stroked');
                    $("#priority_undued" + number).toggleClass('stroked');
                    $("#undued" + number).toggleClass('dark-back');
                    //schedule_nodue 배열 값 변경
                    if(schedule_nodue[number].finished == false) {
                        schedule_nodue[number].finished = true;
                    } else {
                        schedule_nodue[number].finished = false;
                    }
                }
                else {
                    var check_dued = $("#check_dued" + number);
                    $("#title_dued" + number).toggleClass('stroked');
                    $("#content_dued" + number).toggleClass('stroked');
                    $("#duedate" + number).toggleClass('stroked');
                    $("#priority_dued" + number).toggleClass('stroked');
                    $("#dued" + number).toggleClass('dark-back');
                    if(schedule[number].finished == false) {
                        schedule[number].finished = true;
                    } else {
                        schedule[number].finished = false;
                    }
                }
                /*
                console.log(schedule);
                console.log(schedule_nodue);
                */
            }

            //function save(number, is_undued)
            //수정한 일정 내용을 저장할 때 사용.
            //is_undued가 true이면, 기한이 없는 일정에 대해 저장한다. 반대면, 기한이 있는 일정에 대해 수정사항을 저장한다.
            function save(number, is_undued) {
                if(is_undued == true) {
                    var modBtn = $("#modifyBtnUndued" + number);
                    modBtn.html("수정");
                    modBtn.toggleClass('pink-back');
                    modBtn.attr('onclick', 'modify(' + number + ',true)');

                    var newtitle = $("#title_undued" + number);
                    var newcontent = $("#content_undued" + number);
                    var newpriority = $("#priority_undued" + number);

                    var inptitle = "<div id='title_undued" + number + "'>" + newtitle.val() + "</div>";
                    var inpcontent = "<div id='content_undued" + number + "'>" + newcontent.val() + "</div></div>";
                    var inppriority = "<div id='priority_undued" + number + "'>" + newpriority.val() + "</div></div>";
                    
                    newtitle.replaceWith(inptitle);
                    newcontent.replaceWith(inpcontent);
                    newpriority.replaceWith(inppriority);
                    if($("#check_undued" + number).is(":checked") == true) {//수정 시 취소선 지워짐 해결
                        $("#title_undued" + number).toggleClass('stroked');
                        $("#content_undued" + number).toggleClass('stroked');
                        $("#priority_undued" + number).toggleClass('stroked');
                    }
                    //schedule_nodue 배열 값 변경
                    schedule_nodue[number].title = newtitle.val();
                    schedule_nodue[number].content = newcontent.val();
                    schedule_nodue[number].priority = newpriority.val();
                } else {
                    var modBtn = $("#modifyBtnDued" + number);
                    modBtn.html("수정");
                    modBtn.toggleClass('pink-back');
                    modBtn.attr('onclick', 'modify(' + number + ',false)');

                    var newtitle = $("#title_dued" + number);
                    var newcontent = $("#content_dued" + number);
                    var newduedate = $("#duedate" + number);
                    var newpriority = $("#priority_dued" + number);

                    var inptitle = "<div id='title_dued" + number + "'>" + newtitle.val() + "</div>";
                    var inpcontent = "<div id='content_dued" + number + "'>" + newcontent.val() + "</div></div>";
                    var inpduedate = "<div id='duedate" + number + "'>" + newduedate.val() + "</div></div>";
                    var inppriority = "<div id='priority_dued" + number + "'>" + newpriority.val() + "</div></div>";
                    
                    newtitle.replaceWith(inptitle);
                    newcontent.replaceWith(inpcontent);
                    newduedate.replaceWith(inpduedate);
                    newpriority.replaceWith(inppriority);
                    if($("#check_dued" + number).is(":checked") == true) {//수정 시 취소선 지워짐 해결
                        $("#title_dued" + number).toggleClass('stroked');
                        $("#content_dued" + number).toggleClass('stroked');
                        $("#duedate" + number).toggleClass('stroked');
                        $("#priority_dued" + number).toggleClass('stroked');
                    }
                    //schedule 배열 값 변경
                    schedule[number].title = newtitle.val();
                    schedule[number].content = newcontent.val();
                    schedule[number].due = newduedate.val();
                    schedule[number].priority = newpriority.val();
                }
                /*
                //for test
                console.log(schedule);
                console.log(schedule_nodue);
                */
            }

            //function delete_list(number, is_undued)
            //각 일정을 삭제할 때 사용,
            //삭제 버튼을 눌렀을 때 호출됨.
            //is_undued는 기한이 있는 일정인지(false) 없는 일정인지(true) 확인하는 bool 변수
            function delete_list(number, is_undued) {
                if(is_undued == true) {
                    var target = $("#undued" + number);
                    target.remove();
                    schedule_nodue_index.splice(number, 1);//인덱스 배열에서 삭제
                } else {
                    var target = $("#dued" + number);
                    target.remove();
                    schedule_index.splice(number, 1);//인덱스 배열에서 삭제
                }
                /*
                //for test
                console.log(schedule_nodue_index);
                console.log(schedule_index);
                */
            }

            //function modify(number, is_undued)
            //각 일정의 내용을 수정할 때 사용,
            //수정 버튼을 눌렀을 때 호출되며, 수정 버튼은 저장 버튼으로 바뀐다.
            //버튼이 저장 버튼으로 바뀌었음을 표시하기 위해, 버튼의 색을 바꿈.
            function modify(number, is_undued) {
                if(is_undued == true) {
                    var modBtn = $("#modifyBtnUndued" + number);
                    modBtn.html("저장");
                    modBtn.toggleClass('pink-back');
                    modBtn.attr('onclick', 'save(' + number + ',true)');
                    
                    var newtitle = $("#title_undued" + number);
                    var newcontent = $("#content_undued" + number);
                    var newpriority = $("#priority_undued" + number);
                    
                    var inptitle = "<input class='changer' type='text' id='title_undued" + number + "' value='" + newtitle.html() + "'>";
                    var inpcontent = "<input class='changer' type='text' id='content_undued" + number + "' value='" + newcontent.html() + "'>";
                    var inppriority = "<input class='changer' type='number' min='0' max='999' id='priority_undued" + number + "' value='" + newpriority.html() + "'>";
                    
                    newtitle.replaceWith(inptitle);
                    newcontent.replaceWith(inpcontent);
                    newpriority.replaceWith(inppriority);
                } else {
                    var modBtn = $("#modifyBtnDued" + number);
                    modBtn.html("저장");
                    modBtn.toggleClass('pink-back');
                    modBtn.attr('onclick', 'save(' + number + ',false)');
                    
                    var newtitle = $("#title_dued" + number);
                    var newcontent = $("#content_dued" + number);
                    var newduedate = $("#duedate" + number);
                    var newpriority = $("#priority_dued" + number);
                    
                    var inptitle = "<input class='changer' type='text' id='title_dued" + number + "' value='" + newtitle.html() + "'>";
                    var inpcontent = "<input class='changer' type='text' id='content_dued" + number + "' value='" + newcontent.html() + "'>";
                    var inpduedate = "<input class='changer' type='date' id='duedate" + number + "' value='" + newduedate.html() + "'>";
                    var inppriority = "<input class='changer' type='number' min='0' max='999' id='priority_dued" + number + "' value='" + newpriority.html() + "'>";
                    
                    newtitle.replaceWith(inptitle);
                    newcontent.replaceWith(inpcontent);
                    newduedate.replaceWith(inpduedate);
                    newpriority.replaceWith(inppriority);
                }
            }

            //document의 기본 click event를 설정.
            //일정 추가 버튼에 대한 이벤트와,
            //일정 추가 시, 기한의 유무를 설정해주는 체크박스 클릭 시 발생하는 이벤트에 대한 함수를 정의함.
            $(document).ready(function() {
                $("#addButton").click(function() {//일정 추가 버튼
                    if($("#dueOrNot").is(':checked')) {
                        var number = schedule_nodue.length;//0번째부터~n-1번째 까지
                        schedule_nodue.push({
                            id: number,
                            title: $("#title").val(),
                            content: $("#content").val(),
                            due: "none",
                            priority: $("#priority").val(),
                            finished: false
                        });
                        schedule_nodue_index.push(number);//인덱스 값 추가
                        var adder = ""
                        adder += "<div class='container list' id='undued" + number + "'>"
                        adder += "<div class='row'>"
                        adder += "<div class='col-md-auto'><input type='checkbox' class='bigcheck' onclick='done(" + number + ", true )' id='check_undued" + number + "'></div>"
                        adder += "<div class='col'><div id='title_undued" + number + "'>" + schedule_nodue[number].title + "</div></div>"
                        adder += "<div class='col'><div id='content_undued" + number + "'>" + schedule_nodue[number].content + "</div></div>"
                        adder += "<div class='col'><div id='priority_undued" + number + "'>" + schedule_nodue[number].priority + "</div></div>"
                        adder += "</div>"
                        adder += "<div class='row'><button class='btn col modbtn' id='modifyBtnUndued" + number + "' onclick='modify(" + number + ",true)'>수정</button>"
                        adder += "<button class='btn col modbtn' id='deleteBtnUndued" + number + "' onclick='delete_list(" + number + ",true)'>삭제</button></div>"
                        adder += "</div>"
                        $("#undued").append(adder);
                    }
                    else {
                        var number = schedule.length;
                        schedule.push({
                            id: number,
                            title: $("#title").val(),
                            content: $("#content").val(),
                            due: $("#duedate").val(),
                            priority: $("#priority").val(),
                            finished: false
                        });
                        schedule_index.push(number);
                        var adder = ""
                        adder += "<div class='container list' id='dued" + number + "'>"
                        adder += "<div class='row'>"
                        adder += "<div class='col-md-auto'><input type='checkbox' class='bigcheck' onclick='done(" + number + ", false)' id='check_dued" + number + "'></div>"
                        adder += "<div class='col'><div id='title_dued" + number + "'>" + schedule[number].title + "</div></div>"
                        adder += "<div class='col'><div id='content_dued" + number + "'>" + schedule[number].content + "</div></div>"
                        adder += "<div class='col'><div id='duedate" + number +"'>" + schedule[number].due + "</div></div>"
                        adder += "<div class='col'><div id='priority_dued" + number + "'>" + schedule[number].priority + "</div></div>"
                        adder += "</div>"
                        adder += "<div class='row'><button class='btn col modbtn' id='modifyBtnDued" + number + "' onclick='modify(" + number + ",false)'>수정</button>"
                        adder += "<button class='btn col modbtn' id='deleteBtnDued" + number + "' onclick='delete_list(" + number + ",false)'>삭제</button></div>"
                        adder += "</div>"
                        $("#dued").append(adder);
                    }
                    /*
                    //for test
                    console.log(schedule);
                    console.log(schedule_index);
                    console.log(schedule_nodue);
                    console.log(schedule_nodue_index);
                    */
                });
                $('#dueOrNot').click(function() {
                    if ($(this).is(':checked')) {
                        $("#duedate").fadeOut(200);
                    } else {
                        $("#duedate").fadeIn(200);
                    }
                });
            });
        </script>
    </body>
</html>